(function(){var t,i;return t=function(){function t(t,i,e,s,h){this.parent=t,this.element=i,this.x=e,this.y=s,this.value=null!=h?h:!1,this.item=$('<span class="playfield-item"/>'),this.element.empty().append(this.item),this.set()}return t.prototype.update=function(t,i){var e;return null==t&&(t=!1),this.item.removeClass(function(){var t,i,s,h;for(s=this.parent.types,h=[],t=0,i=s.length;i>t;t++)e=s[t],h.push(e["class"]);return h}.call(this).join(" ")),e=this.parent.types[this.value],this.item.addClass(e["class"]),location.hash.match(/debug/)&&this.item.text(i||""),this.element.toggleClass("playfield-chain",t)},t.prototype.set=function(t){return null==t&&(t=!1),this.value=t!==!1?t:~~(123456*Math.random()),this.value=this.value%this.parent.types.length,this.element.data("value",this.value)},t}(),i=function(){function i(i,e,s,h){var n,l,a,r,f,o,d,u,p,c;for(this.types=e,this.width=null!=s?s:10,this.height=null!=h?h:8,this.field={},a=$('<table class="playfield"/>'),o=d=1,p=this.height;p>=1?p>=d:d>=p;o=p>=1?++d:--d){for(l=$("<tr/>"),this.field[o]={},f=u=1,c=this.width;c>=1?c>=u:u>=c;f=c>=1?++u:--u)r=$('<td class="playfield-field"/>'),n=new t(this,r,f,o),this.field[o][f]=n,r.data("x",f),r.data("y",o),l.append(r);a.append(l)}$(i).append(a),this.display()}return i.prototype.randomize=function(){var t,i,e,s,h,n;for(i=e=1,h=this.height;h>=1?h>=e:e>=h;i=h>=1?++e:--e)for(t=s=1,n=this.width;n>=1?n>=s:s>=n;t=n>=1?++s:--s)this.field[i][t].set();return this},i.prototype.set=function(t,i,e){return this.field[i][t].set(e),this},i.prototype.display=function(){var t,i,e,s,h,n,l,a,r,f,o,d,u,p,c,y,v,m,g,w,$,x,z,C,b,j;for(i={},n=l=1,v=this.height;v>=1?v>=l:l>=v;n=v>=1?++l:--l)for(i[n]={},h=a=1,m=this.width;m>=1?m>=a:a>=m;h=m>=1?++a:--a)i[n][h]=0;for(h=r=1,g=this.width;g>=1?g>=r:r>=g;h=g>=1?++r:--r)for(n=f=1,w=this.height;w>=1?w>=f:f>=w;n=w>=1?++f:--f)if(!(--t>=1)){for(s=this.field[n][h].value,t=1;this.height>=n+t&&this.field[n+t][h].value===s;)t+=1;if(t>=3)for(e=o=0,$=t-1;$>=0?$>=o:o>=$;e=$>=0?++o:--o)i[n+e][h]+=t}for(n=d=1,x=this.height;x>=1?x>=d:d>=x;n=x>=1?++d:--d)for(h=u=1,z=this.width;z>=1?z>=u:u>=z;h=z>=1?++u:--u)if(!(--t>=1)){for(s=this.field[n][h].value,t=1;this.width>=h+t&&this.field[n][h+t].value===s;)t+=1;if(t>=3)for(e=p=0,C=t-1;C>=0?C>=p:p>=C;e=C>=0?++p:--p)i[n][h+e]+=t}for(n=c=1,b=this.height;b>=1?b>=c:c>=b;n=b>=1?++c:--c)for(h=y=1,j=this.width;j>=1?j>=y:y>=j;h=j>=1?++y:--y)this.field[n][h].update(i[n][h]>0,i[n][h]);return this},i}(),$.getJSON("types.json",function(t){var e;return e=new i("#field",t),$(".playfield-field").on("click",function(){var t;return t=$(this).data(),e.set(t.x,t.y,t.value+1),e.display()}),$("#randomize").on("click",function(){return e.randomize().display()})})})();